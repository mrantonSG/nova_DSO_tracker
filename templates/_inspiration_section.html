<style>
    /* --- Grid & Tile Styles --- */
    #inspiration-wrapper {
        padding: 20px 0;
        width: 100%;
        min-height: 200px;
    }

    .inspiration-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
    }

    .astro-tile {
        background: var(--bg-white);
        border: 1px solid var(--text-lightest);
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        height: 100%;
        cursor: pointer;
        position: relative;
    }

    .astro-tile:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }

    .tile-image {
        width: 100%;
        height: 200px;
        background-color: var(--accent-teal); /* Dark background for space images */
        position: relative;
        overflow: hidden;
        border-bottom: 1px solid var(--bg-medium-alt);
    }

    .tile-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Attribution Badge overlay on image */
    .img-source-badge {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background: rgba(0, 0, 0, 0.6);
        color: rgba(255, 255, 255, 0.8);
        padding: 2px 6px;
        font-size: 10px;
        border-radius: 4px;
        pointer-events: none;
    }

    .tile-content {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .tile-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 4px;
    }

    .tile-title { font-size: 1.2em; font-weight: 700; color: var(--accent-teal); }
    .tile-type { font-size: 0.75em; text-transform: uppercase; color: var(--primary-color); font-weight: 600; background: var(--bg-light-gray); padding: 2px 6px; border-radius: 4px; }
    .tile-common-name { font-size: 0.9em; color: var(--text-tertiary); font-style: italic; margin-bottom: 10px; }

    .tile-summary {
        font-size: 0.85em;
        color: var(--text-secondary);
        line-height: 1.5;
        margin-bottom: 15px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .tile-stats {
        display: flex;
        gap: 8px;
        margin-top: auto;
        font-size: 0.8em;
        color: var(--text-secondary);
    }

    .tile-stat-pill {
        background: var(--bg-light);
        padding: 4px 8px;
        border-radius: 4px;
        border: 1px solid var(--border-light-alt);
    }

    /* --- Modal Styles --- */
    .insp-modal-backdrop {
        display: none;
        position: fixed;
        z-index: 3000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.6);
        backdrop-filter: blur(2px);
    }

    .insp-modal-content {
        background-color: var(--bg-white);
        margin: 5vh auto;
        width: 90%;
        max-width: 800px;
        border-radius: 12px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        max-height: 90vh;
        animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .insp-modal-body {
        display: flex;
        flex-direction: row;
        overflow-y: auto;
    }

    .insp-modal-image {
        width: 40%;
        background: var(--text-black);
        min-height: 300px;
        position: relative;
    }

    .insp-modal-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .insp-modal-details {
        width: 60%;
        padding: 30px;
        display: flex;
        flex-direction: column;
    }

    .insp-modal-title { font-size: 2em; font-weight: bold; margin: 0 0 5px 0; color: var(--accent-teal); }
    .insp-modal-subtitle { font-size: 1.2em; color: var(--text-tertiary); font-style: italic; margin-bottom: 20px; }

    .insp-modal-text {
        font-size: 1em;
        line-height: 1.6;
        color: var(--text-dark-alt);
        margin-bottom: 25px;
    }

    .insp-data-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        background: var(--bg-light);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 25px;
    }

    .insp-data-item strong { display: block; font-size: 0.8em; color: var(--text-muted); text-transform: uppercase; }
    .insp-data-item span { font-size: 1.1em; font-weight: 600; color: var(--text-primary); }

    .insp-modal-footer {
        margin-top: auto;
        display: flex;
        justify-content: space-between; /* Space out attribution and buttons */
        align-items: center;
        gap: 10px;
    }

    .modal-attribution {
        font-size: 0.8em;
        color: var(--text-muted-alt);
    }

    .modal-attribution a {
        color: var(--text-muted-alt);
        text-decoration: underline;
    }

    .btn-close-modal {
        background: transparent;
        border: 1px solid var(--border-medium-alt);
        padding: 8px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
    }

    .btn-view-graph {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
    }
    .btn-view-graph:hover { background: var(--primary-dark); }

    /* Skeleton Loading State */
    .skeleton-pulse { animation: pulse 1.5s infinite ease-in-out; background-color: var(--bg-medium-alt); }
    @keyframes pulse { 0% { background-color: var(--bg-medium-alt); } 50% { background-color: var(--text-lighter); } 100% { background-color: var(--bg-medium-alt); } }

    @media (max-width: 700px) {
        .insp-modal-body { flex-direction: column; }
        .insp-modal-image, .insp-modal-details { width: 100%; }
        .insp-modal-image { height: 200px; }
    }

    /* --- New Educational States --- */
    .inspiration-banner {
        background: var(--bg-light-gray);
        border: 1px solid var(--info-color-alt);
        color: var(--info-text);
        padding: 15px 20px;
        margin-bottom: 25px;
        border-radius: 8px;
        display: flex;
        align-items: start;
        gap: 15px;
        font-size: 14px;
        line-height: 1.5;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .inspiration-banner strong { color: var(--text-primary); font-size: 15px; }
    .inspiration-banner .close-banner {
        cursor: pointer;
        font-weight: bold;
        color: var(--info-text);
        opacity: 0.5;
        margin-left: auto;
        font-size: 18px;
        line-height: 1;
    }
    .inspiration-banner .close-banner:hover { opacity: 1; }

    .empty-state-styled {
        /* CRITICAL FIX: Force the box to span all grid columns (1 to end) */
        grid-column: 1 / -1;

        text-align: center;
        padding: 60px 20px;
        color: var(--text-tertiary);
        background: var(--bg-light-alt);
        border-radius: 12px;
        border: 2px dashed var(--text-lightest);
        /* Center horizontally and limit width for better appearance */
        margin: 40px auto;
        max-width: 600px;
    }
    .empty-state-icon { font-size: 48px; margin-bottom: 15px; opacity: 0.8; }
    .empty-state-box {
        text-align: left;
        display: inline-block;
        max-width: 450px;
        font-size: 14px;
        background: var(--bg-white);
        padding: 20px 25px;
        border-radius: 8px;
        border: 1px solid var(--bg-medium-alt);
        box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }

    /* Loading Spinner */
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .insp-spinner {
        border: 4px solid var(--bg-light-gray);
        border-top: 4px solid var(--info-color-alt);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px auto;
    }
</style>

<div id="inspiration-tab-content" style="display:none;">
    <div id="inspiration-controls" style="margin-bottom: 15px; display: flex; justify-content: flex-end;">
        <button type="button" data-action="refresh-inspiration" style="padding: 10px 20px; border:1px solid var(--border-medium-alt); border-radius:4px; font-size:14px; background:var(--bg-white); cursor: pointer;">
            â†» Refresh Suggestions
        </button>
    </div>

    <div id="inspiration-wrapper">
        <div id="inspiration-grid" class="inspiration-grid"></div>
        <div id="inspiration-loading" style="display:none; text-align:center; padding:40px; color:var(--text-tertiary);">
            Processing targets...
        </div>
    </div>
</div>

<div id="inspiration-modal" class="insp-modal-backdrop" data-action="close-inspiration-modal">
    <div class="insp-modal-content" data-stop-propagation="true">
        <div class="insp-modal-body">
            <div class="insp-modal-image">
                <img id="modal-img" src="" alt="Object Image">
            </div>
            <div class="insp-modal-details">
                <h2 id="modal-title" class="insp-modal-title"></h2>
                <div id="modal-subtitle" class="insp-modal-subtitle"></div>

                <div id="modal-text" class="insp-modal-text"></div>

                <div class="insp-data-grid">
                    <div class="insp-data-item"><strong>Max Altitude</strong><span id="modal-alt"></span></div>
                    <div class="insp-data-item"><strong>Transit Time</strong><span id="modal-transit"></span></div>
                    <div class="insp-data-item"><strong>Duration</strong><span id="modal-dur"></span></div>
                    <div class="insp-data-item"><strong>Constellation</strong><span id="modal-const"></span></div>
                </div>

                <div class="insp-modal-footer">
                    <div id="modal-attribution" class="modal-attribution">Source: Wiki</div>
                    <div style="display:flex; gap:10px; flex-shrink: 0;">
                        <button class="btn-close-modal" data-action="close-inspiration-modal">Close</button>
                        <button class="btn-view-graph" id="modal-graph-btn">View Charts &rarr;</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function getAladinFallbackUrl(ra, dec, sizeArcmin) {
        if (ra == null || dec == null) return null;
        let size = parseFloat(sizeArcmin) || 15;
        if (size < 5) size = 5;
        if (size > 60) size = 60;
        return `https://archive.stsci.edu/cgi-bin/dss_search?v=poss2ukstu_red&r=${ra}&d=${dec}&e=J2000&h=${size}&w=${size}&f=gif&c=none`;
    }

    // ========================================================================
    // 3. MAIN LOGIC (Failsafe)
    // ========================================================================
    async function renderInspirationGrid(event) {
        if(event) { event.preventDefault(); event.stopPropagation(); }

        const grid = document.getElementById('inspiration-grid');
        const loading = document.getElementById('inspiration-loading');
        if (!grid) return;

        try {
            grid.innerHTML = '';
            loading.style.display = 'block';
            loading.textContent = "Analyzing targets...";

            // 1. Get Data (Safety Check)
            let dataSource = window.currentFilteredData;
            // Check total count to distinguish between "Filtering" and "Loading/Empty DB"
            const totalDataCount = (window.latestDSOData || []).length;

            // FIX: Only fallback to full data if NO filters are active.
            // If filters ARE active but returned 0 results, dataSource should remain empty.
            if ((!dataSource || dataSource.length === 0) && !window.isListFiltered) {
                dataSource = window.latestDSOData || [];
            }

            // Remove any existing banners from previous renders
            const existingBanner = document.querySelector('.inspiration-banner');
            if (existingBanner) existingBanner.remove();

            // Check global loading state from main app
            const isGlobalLoading = document.getElementById("data-body")?.dataset.loading === 'true';

            if (dataSource.length === 0) {
                loading.style.display = 'none';

                // --- RICH EMPTY STATE ---
                const isTrueFilterZero = window.isListFiltered && totalDataCount > 0;

                // Dynamic Loading State Handling
                let iconHtml = '<div class="empty-state-icon">ðŸ”­</div>';
                let title = "No Matching Targets";
                let reason = "Your current filters (Position Tab) are too restrictive.";

                if (!isTrueFilterZero) {
                    if (isGlobalLoading) {
                        // Active Loading State
                        iconHtml = '<div class="insp-spinner"></div>';
                        title = "Loading Object Database...";
                        reason = "Please wait while we calculate visibility and fetch data.";
                    } else {
                        // Truly Empty DB State
                        title = "Database Empty";
                        reason = "No objects found in your configuration.";
                    }
                }

                grid.innerHTML = `
                    <div class="empty-state-styled">
                        ${iconHtml}
                        <h3 style="margin: 0 0 10px 0; color: var(--text-primary);">${title}</h3>
                        <p style="margin: 0 0 25px 0;">${reason}</p>
                        <div class="empty-state-box">
                            <strong style="color:var(--text-primary);">How to populate this gallery:</strong>
                            <ul style="margin: 10px 0 0 0; padding-left: 20px; color: var(--text-secondary); line-height:1.6;">
                                <li><strong>Check Filters:</strong> Clear filters on the Position tab.</li>
                                <li><strong>Check Database:</strong> Ensure you have objects in <em>Configuration</em>.</li>
                                <li><strong>Visibility:</strong> We only show objects observable during <em>tonight's session</em>.</li>
                            </ul>
                        </div>
                    </div>`;
                return;
            }

            // 2. Filter Candidates (with fallback)
            let candidates = filterCandidates(dataSource, 40, 45); // Gold
            if (candidates.length === 0) candidates = filterCandidates(dataSource, 25, 30); // Silver
            if (candidates.length === 0) candidates = filterCandidates(dataSource, 15, 1); // Bronze

            // Failsafe: If filtering removed EVERYTHING (e.g. day time), pick ANY object
            // This prevents the "blank screen" issue.
            if (candidates.length === 0) {
                console.warn("[Inspiration] No visible targets found. Showing unfiltered fallback.");
                candidates = dataSource.slice(0, 50); // Just take top 50 raw items
            }

            // Sort & Shuffle
            // Sort by Altitude Descending (best ones first)
            candidates.sort((a, b) => {
                const altA = parseFloat(a['Max Altitude (Â°)']) || 0;
                const altB = parseFloat(b['Max Altitude (Â°)']) || 0;
                return altB - altA;
            });

            // Shuffle top pool
            const poolSize = Math.min(candidates.length, 30);
            const topPool = candidates.slice(0, poolSize);
            for (let i = topPool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [topPool[i], topPool[j]] = [topPool[j], topPool[i]];
            }
            const topPicks = topPool.slice(0, 12);

            loading.style.display = 'none';

            // --- ONBOARDING BANNER CHECK ---
            // 1. Check current visible candidates
            const hasCustomImages = candidates.some(obj => obj.image_url && obj.image_url.trim() !== "");

            // 2. Check GLOBAL dataset (prevents banner if user has images elsewhere but filtered out)
            //    This stops the banner from annoying users who already know how to use the feature.
            const globalHasCustom = (window.latestDSOData || []).some(obj => obj.image_url && obj.image_url.trim() !== "");

            // Check if data is still streaming (prevents banner flicker on partial loads)
            const isLoading = document.getElementById("data-body")?.dataset.loading === 'true';

            // Only show if: No custom images in current set, No custom images globally, Data exists, and Not loading
            if (!hasCustomImages && !globalHasCustom && candidates.length > 0 && !isLoading) {
                const wrapper = document.getElementById('inspiration-wrapper');
                const banner = document.createElement('div');
                banner.className = 'inspiration-banner';
                banner.innerHTML = `
                    <div style="font-size: 24px;"></div>
                    <div>
                        <strong>Add Your Own Inspiration!</strong><br>
                        You are currently seeing automated survey images (DSS2).<br>
                        Did you know you can display your own astrophotos or favorite reference images here?<br>
                        <span style="color:var(--text-secondary); font-size:0.9em; margin-top:4px; display:block;">Go to <strong>Configuration &gt; Manage Objects</strong> to add "Inspiration Content" (Image URLs, Credits, Descriptions) to your targets.</span>
                    </div>
                    <span class="close-banner" data-action="close-banner">âœ•</span>
                `;
                // Insert before the grid container
                wrapper.insertBefore(banner, grid);
            }

            // 3. Render Tiles
            for (const obj of topPicks) {
                const raDeg = (parseFloat(obj['RA (hours)']) || 0) * 15;
                const decDeg = parseFloat(obj['DEC (degrees)']) || 0;
                const dssUrl = getAladinFallbackUrl(raDeg, decDeg, obj.Size);
                const hasCoords = (dssUrl !== null);

                // Create Skeleton
                const tile = document.createElement('div');
                tile.className = 'astro-tile';
                tile.innerHTML = `
                    <div class="tile-image skeleton-pulse">
                        <img style="opacity:0;">
                        <div class="img-source-badge" style="display:none;"></div>
                    </div>
                    <div class="tile-content">
                        <div class="tile-header">
                            <span class="tile-title">${obj.Object}</span>
                            <span class="tile-type">${obj.Type || ''}</span>
                        </div>
                        <div class="tile-common-name">${obj['Common Name'] || ''}</div>
                        <div class="tile-summary skeleton-text">Loading...</div>
                        <div class="tile-stats">
                            <div class="tile-stat-pill">Alt: ${obj['Max Altitude (Â°)']}</div>
                            <div class="tile-stat-pill">Dur: ${Math.round((parseFloat(obj['Observable Duration (min)'])||0)/60*1)/1}h</div>
                        </div>
                    </div>
                `;
                grid.appendChild(tile);

                // Async Resolve
                (async () => {
                    const imgEl = tile.querySelector('img');
                    const badgeEl = tile.querySelector('.img-source-badge');
                    const sumEl = tile.querySelector('.tile-summary');

                    let finalImg = null;
                    let finalImgSource = "";
                    let finalImgLink = "";

                    let finalText = "";
                    let finalDescSource = "";
                    let finalDescLink = "";

                    // 1. Database Content (Primary)
                    if (obj.image_url) {
                        finalImg = obj.image_url;
                        finalImgSource = obj.image_credit || "Catalog";
                        finalImgLink = obj.image_source_link || "";
                    }

                    if (obj.description_text) {
                        finalText = obj.description_text;
                        finalDescSource = obj.description_credit || "";
                        finalDescLink = obj.description_source_link || "";
                    }

                    // 2. Fallback: DSS2 (Image Only)
                    if (!finalImg && hasCoords) {
                        finalImg = dssUrl;
                        finalImgSource = "DSS2";
                    }

                    // 5. Update UI
                    const setOfflineState = () => {
                        tile.querySelector('.tile-image').classList.remove('skeleton-pulse');
                        tile.querySelector('.tile-image').innerHTML = `
                            <div class="offline-message" style="height:100%; min-height:0; border:none; background:var(--bg-light); border-radius:0; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:0;">
                                <div style="font-size:24px; opacity:0.3; margin-bottom:5px; filter: grayscale(1);">ðŸ“¡</div>
                                <div style="font-size:12px; color:var(--text-muted-alt);">Offline</div>
                            </div>`;
                    };

                    imgEl.onload = () => {
                        imgEl.style.opacity = '1';
                        tile.querySelector('.tile-image').classList.remove('skeleton-pulse');
                    };

                    imgEl.onerror = () => {
                        // Image failed to load (e.g. broken link or network drop)
                        setOfflineState();
                    };

                    if (!navigator.onLine) {
                        // Browser is strictly offline
                        setOfflineState();
                    } else if (finalImg) {
                        imgEl.src = finalImg;
                        badgeEl.textContent = finalImgSource;
                        badgeEl.style.display = 'block';
                    } else {
                        // No image URL found
                        tile.querySelector('.tile-image').innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100%;color:var(--text-muted-alt);">No Image</div>';
                        tile.querySelector('.tile-image').classList.remove('skeleton-pulse');
                    }

                    if (finalText) {
                        sumEl.textContent = finalText;
                    } else {
                        sumEl.textContent = `Type: ${obj.Type || 'DSO'}. Located in ${obj.Constellation || 'unknown'}.`;
                    }
                    sumEl.classList.remove('skeleton-text');

                    tile.onclick = () => openInspirationModal(obj, finalImg, finalText || sumEl.textContent, finalImgSource, finalImgLink, finalDescSource, finalDescLink);

                })();
            }
        } catch (err) {
            console.error("Critical Grid Error:", err);
            grid.innerHTML = '<div class="empty-state"><p>Error rendering grid. Check console.</p></div>';
            loading.style.display = 'none';
        }
    }

    // --- Helpers (Unchanged) ---
    function filterCandidates(data, minAlt, minDur) {
        return data.filter(obj => {
            if (obj.error) return false;
            const maxAlt = parseFloat(obj['Max Altitude (Â°)']);
            const duration = parseFloat(obj['Observable Duration (min)']);
            return !isNaN(maxAlt) && maxAlt > minAlt && !isNaN(duration) && duration > minDur;
        });
    }

    function openInspirationModal(obj, imgSrc, summary, source, wikiUrl) {
        const modal = document.getElementById('inspiration-modal');
        const imgEl = document.getElementById('modal-img');
        const imgContainer = document.querySelector('.insp-modal-image');

        // Helper to show offline/error state inside the modal
        const showOfflinePlaceholder = () => {
            imgEl.style.display = 'none';
            // Only append if not already there
            if (!imgContainer.querySelector('.offline-message')) {
                const offlineDiv = document.createElement('div');
                offlineDiv.className = 'offline-message';
                offlineDiv.style.cssText = "height:100%; min-height:0; border:none; background:var(--code-bg); display:flex; flex-direction:column; align-items:center; justify-content:center; width: 100%;";
                offlineDiv.innerHTML = '<div style="font-size:40px; opacity:0.3; margin-bottom:10px; filter: grayscale(1);">ðŸ“¡</div><div style="color:var(--text-quaternary);">Image unavailable</div>';
                imgContainer.appendChild(offlineDiv);
            }
        };

        // 1. Reset State (Remove old placeholders, show image tag)
        const existingMsg = imgContainer.querySelector('.offline-message');
        if(existingMsg) existingMsg.remove();
        imgEl.style.display = 'block';

        // 2. Handle Image Logic
        if (!navigator.onLine && imgSrc) {
            // Offline Mode
            showOfflinePlaceholder();
        } else {
            // Online Mode (or attempting to load)
            imgEl.src = imgSrc || "";

            if (!imgSrc) {
                imgEl.style.display = 'none'; // Just black background if no image exists
            }

            // Fallback: If image fails to load (e.g. broken link), show placeholder
            imgEl.onerror = function() {
                showOfflinePlaceholder();
            };
        }

        // 3. Populate Data
        document.getElementById('modal-title').textContent = obj.Object;
        document.getElementById('modal-subtitle').textContent = obj['Common Name'] || "";
        document.getElementById('modal-alt').textContent = obj['Max Altitude (Â°)'];
        document.getElementById('modal-transit').textContent = obj['Transit Time'];
        document.getElementById('modal-dur').textContent = Math.round((parseFloat(obj['Observable Duration (min)'])||0)/60*10)/10 + " hrs";
        document.getElementById('modal-const').textContent = obj.Constellation || "N/A";
        document.getElementById('modal-text').textContent = summary;

        // 4. Handle Attribution
        const attrib = document.getElementById('modal-attribution');
        if (source === "Wiki") {
            attrib.innerHTML = `Source: <a href="${wikiUrl}" target="_blank">Wikipedia</a>`;
        } else if (source === "NASA") {
            attrib.innerHTML = `Source: <a href="${wikiUrl}" target="_blank">NASA</a>`;
        } else if (source === "DSS2") {
            attrib.innerHTML = `Source: Aladin Sky Atlas / DSS2`;
        } else {
            if (wikiUrl) {
                attrib.innerHTML = `Source: <a href="${wikiUrl}" target="_blank">${source}</a>`;
            } else {
                attrib.innerHTML = `Source: ${source}`;
            }
        }

        // 5. Setup Action Buttons
        document.getElementById('modal-graph-btn').onclick = () => showGraph(obj.Object, null, 'chart');

        // 6. SHOW MODAL (This is the critical line)
        modal.style.display = 'block';
    }

    function closeInspirationModal() {
        document.getElementById('inspiration-modal').style.display = 'none';
    }

    // --- Event delegation for inspiration section data-actions ---
    document.addEventListener('click', function(e) {
        const target = e.target.closest('[data-action]');
        if (!target) return;

        // Stop propagation if requested
        if (target.closest('[data-stop-propagation="true"]')) {
            e.stopPropagation();
            return;
        }

        const action = target.dataset.action;

        switch(action) {
            case 'refresh-inspiration':
                renderInspirationGrid(e);
                break;
            case 'close-inspiration-modal':
                closeInspirationModal();
                e.preventDefault();
                break;
        }
    });

    // Expose functions for use by other scripts
    window.renderInspirationGrid = renderInspirationGrid;
    window.closeInspirationModal = closeInspirationModal;
</script>